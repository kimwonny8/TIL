# 웹 해킹



개발을 할 때, 보안에도 당연히 신경을 써야하는데 해킹 기법에 대해 무지했던 것 같아 기록을 해보기로했다.



## 웹 해킹이란?

- 웹 사이트의 취약점을 공격하는 기술적 위협으로, 웹 페이지를 통하여 **권한이 없는 시스템에 접근하거나 데이터 유출 및 파괴**와 같은 행위를 말한다.



아래와 같은 내용을 알아보겠다.

1. XSS
2. CSRF Attack
3. SQL Injection
4. Command Injection
5. File Upload Attack
6. JavaScript Injection



## 1. XSS

개발을 하며 특정 문자들이 html  문자로 바껴서 데이터가 들어간 것을 본적이 있었는데, 이것이 xss 공격에 방어한 방법이였다.

**Cross-Site Scription (XSS)**

- 웹 페이지에 악성 자바스크립트를 삽입하는 공격이다.
- CSS라고 불러야하는데, 이미 CSS가 있기 때문에 XSS라고 부른다고 한다.
- 공격 방법은 단순하지만 아주 효과적이다. 



### XSS 종류

- Stored XSS
  - 최근엔 SPA(Single-Page Application)로 배포되는 서비스가 많은데, 인증 관리를 위해 토큰은 `Cookie` 혹은 `localStorage`에 저장하는 경우가 많다. 이때 **XSS** 방어 준비가 되어있지 않은 경우 자바스크립트를 통해 불특정 다수의 사용자 토큰을 손쉽게 탈취 할 수 있다.
- Reflected XSS
  - 입력을 그대로 브라우저에 출력하는 로직을 공격하는 방법이다
- DOM Based XSS
  - 서비스의 스크립트를 이용하여 DOM에 악의적인 스크립트가 노출되도록 공격하는 방법을 말한다. Reflected XSS와 유사해보이지만 서버를 타지않고 DOM을 조작할 수 있기 때문에 문제를 찾기 힘들다는 문제가 있다.



### 방어하는 법

- 서버에 데이터를 저장할 때 HTML 필터링을 한 후 데이터베이스에 저장한다.
- 공격 방어를 위해 서버에서 파라미터 검증을 한다.
- 혹시나 모를 상황에 대비하여 프론트엔드에서도 필터링이 필요하다.
  - 앵커 태그의 `href` 속성은 `<a href='javascript:alert("xss");'>XSS</a>`처럼 자바스크립트 프로토콜을 사용하여 스크립트를 실행시킬 수 있다. 이를 막기 위해서 `href` 속성에 들어가는 값은 추가적인 필터링이 필요하다. 필터링에는 블랙리스트와 화이트리스트가 존재하는데 이 경우 화이트리스트를 통한 필터링을 추천한다. 
    - [참고사이트](https://medium.com/javascript-security/avoiding-xss-in-react-is-still-hard-d2b5c7ad9412)
    - 참고) 블랙리스트 : 거부 목록 / 화이트리스트 : 허용 목록



## 2. CSRF Attack

**Cross-Site Request Forgery**

- 공격자가 서비스 사용자를 이용하여 요청을 보내는 공격을 말한다.

- 해당 조건을 만족해야 한다.

  1. 사용자는 보안이 취약한 서버로부터 이미 로그인되어 있는 상태여야 합니다.

  2. 쿠키 기반의 서버 세션 정보를 획득할 수 있어야 합니다.
  3. 공격자는 서버를 공격하기 위한 요청 방법에 대해 미리 파악하고 있어야 합니다. 
     (예상하지 못한 요청 매개변수가 없어야 합니다.)



### 방어하는 법

https://devscb.tistory.com/123



## 3. SQL Injection

- 서버에서 실행되는 SQL을 악의적으로 이용하는 공격이다.



### 방어하는 법

- SQL에서 특별한 의미를 가지는 문자를 이스케이프한다. ex) \n, \t, |, /, &, #, ...
- 준비된 선언을 사용한다.

준비된 선언은 조금 생소할 수 있는데 Placeholder를 넣은 쿼리를 먼저 DB에 보낸 후 Placeholder에 해당하는 데이터를 DB로 보내는 방법이다. 이를 통해 SQL Injection을 방어할 수 있다.



## 4. Command Injection

- 쉘을 실행시키는 로직을 이용한 공격이다.
- 각 언어마다 쉘 명령을 실행시키는 함수가 존재한다. 예를 들어, Java의 `System.runtime()`이나 `Runtime.exec()`, Python의 `exec()`, `os.system()` 등이 있다. 마찬가지로 각 언어마다 존재하는 `eval()` 함수도 매우 취약하다.



### 방어하는 법

- 쉘 명령을 실행시키는 시스템 함수를 사용하지 않는 것이 중요하다.
- 만약 꼭 사용해야한다면 `|, &, ;, >, <`와 같은 민감한 문자는 필터링하도록 하자.



## 5. File Upload Attack

- 공격 스크립트가 담긴 파일을 서버로 업로드하는 공격이다.



### 방어하는 법

- 확장자와 파일 타입을 검사하여 허락된 타입만 저장한다.
- 해커가 파일을 찾을 수 없도록 업로드 파일의 이름과 확장자를 난수화하여 저장한다.
- 특수 문자가 포함된 경우 업로드를 막는다. (Null byte Injection 방지)



## 6. JavaScript Injection

- 브라우저에서 자바스크립트를 삽입시키는 공격이다. 
- 브라우저에서 제공하는 Console을 통해 조작 가능하다. 
- 만약 Client-Side에 민감한 데이터를 넣어놨다면 해당 공격을 통해 탈취가 가능하다.



### 방어하는 법

- 클라이언트엔 민감한 데이터를 절대 Plain하게 넣지 않는다.
- 데이터 유효성 검사가 필요한 경우 서버에서 처리하도록 한다.



[참고사이트](https://kciter.so/posts/basic-web-hacking)

