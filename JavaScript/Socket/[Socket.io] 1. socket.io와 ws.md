## 웹소켓

> 웹 소켓은 HTML5에 새로 추가된 스펙으로 **실시간 양방향 데이터 전송을 위한 기술**입니다. 최신 브라우저는 대부분 웹 소켓을 지원하고 노드에서는 ws나 Socket.IO 같은 패키지를 통해 웹 소켓을 사용할 수 있습니다. 웹 소켓이 생기기 전에는 주기적으로 서버에 새로운 업데이트가 있는지 확인해서 새로운 내용을 가져오는 방법을 사용했습니다. 웹 소켓은 연결이 이루어지고 나면 계속 연결된 상태이므로 업데이트가 있는지 요청을 보낼 필요가 없고 업데이트가 있으면 서버에서 클라이언트에게 바로 알려줍니다. HTTP 프로토콜과 포트를 공유할 수 있으므로 다른 포트에 연결할 필요도 없습니다.



## socket.io

WebSocket을 기반으로 클라이언트와 서버의 **양방향 통신**을 가능하게 해주는 모듈이다.

WebSocket을 그대로 사용해도 좋지만, Socket.io에는 편의 기능이 많이 추가되어 개발하는 입장에서 사용하기가 굉장히 편리하다.
Socket.io 은 **소켓**을 이용해, 클라이언트와 서버의 양방향 통신을 가능하게 해줌





## socket.io와 ws의 차이

### 1. socket.io는 추가적인 설치를 해야 한다.

둘 다 서버에서는 모듈 설치가 필요하지만 ws는 웹소켓 표준이라 클라이언트에 추가적인 설치를 요구하지 않습니다.
반면, ws에서는 `new WebSocket('서버주소/네임스페이스')`으로 객체를 생성을 바로 사용할 수 있지만, socket.io는 js파일을 추가해야 합니다.

### 2. ws는 string형으로 데이터를 전송한다.

socket.io는 이벤트명과 데이터를 명확하게 구분하고 모든 자료형을 주고 받을 수 있지만, ws는 string 자료형 하나로 데이터를 주고 받습니다. 이벤트명도 데이터에 포함해서 받으므로 데이터를 parsing하는 과정이 필요합니다.
이를 활용하기 위해 주로 `JSON.parse`나 `JSON.stringify`함수를 사용하게 되며, NestJS에서는 `event`로 이벤트명을 지정하고 `data`로 데이터명을 지정하는 규약을 가집니다.

### 3. ws에는 룸이 없다.

socket.io에서는 당연하게 지원되는 room과 broadcast와 같은 기능을 ws에서는 직접 만들어야 하는 경우가 있습니다. 다행히 namespace는 ws도 지원합니다!
socket.io에서는 `서버.broadcast.emit('이벤트명, 데이터)`으로 자신을 제외한 사용자에게 데이터를 보낼 수 있지만, ws에서는 `클라이언트.send(데이터)`를 for문 반복하여 보내야 합니다.

### 4. socket.io는 계속해서 연결을 시도한다.

연결이 끊어졌을 때 socket.io는 주기적으로 연결을 시도합니다. ws는 한번 연결이 끊어졌을 때, 복구되지 않으므로 같은 기능을 구현하려면 추가적인 코드가 필요합니다.